pipeline {
    agent any
	parameters {
		choice(choices: ['THRPT'], description: 'Please choose the build configuration?', name: 'configuration')
    }
    stages {
		stage('Build') {
			steps {
				cleanWs()
				checkout scm
				echo "Build Version ${GIT_COMMIT}"
			}
		}
		stage('Deployment') {
		    withCredentials([usernamePassword(credentialsId: 'ssh-pwd', usernameVariable: 'username', passwordVariable: 'password')]){
		      def remote = [:]
		      remote.name = 'centos-ssh'
		      remote.host = 'centos'
		      remote.user = username
		      remote.password = password
		      remote.allowAnyHosts = true
			steps{
				script {
					def configuration = params.configuration;
					echo "Deploy ${configuration} Configuration On KERRY_THRPT01 Station"
					sshCommand remote: remote, command: "git --version"
					sh "python3.4 ${WORKSPACE}/transfer_stations.py 172.16.10.3 root 2012_noVemBer_02 22 ${configuration}"		
				}
			}
		}
		stage('Clean Workspace') {
			steps {
				cleanWs()
			}
		}
	}
}
